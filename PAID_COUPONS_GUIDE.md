# دليل الكوبونات المدفوعة

## نظرة عامة

تم إضافة ميزة الكوبونات المدفوعة إلى النظام، مما يتيح لك إنشاء كوبونات يمكن للعملاء شراؤها مقابل مبلغ مالي.

## الميزات الجديدة

### 1. حقول جديدة في الكوبونات
- **`price`**: سعر الكوبون بالريال
- **`is_paid`**: مؤشر يوضح ما إذا كان الكوبون مدفوع أم لا

### 2. أنواع الكوبونات
- **كوبونات مجانية**: متاحة للجميع بدون مقابل
- **كوبونات مدفوعة**: تحتاج إلى شراء مقابل مبلغ محدد

## كيفية الاستخدام

### إنشاء كوبون مدفوع
1. اذهب إلى صفحة الكوبونات
2. انقر على "إضافة كوبون"
3. املأ البيانات الأساسية (الكود، الاسم، النوع، القيمة)
4. حدد "كوبون مدفوع"
5. أدخل سعر الكوبون
6. احفظ الكوبون

### إنشاء كوبون مجاني
1. اتبع نفس الخطوات السابقة
2. اترك "كوبون مدفوع" غير محدد
3. احفظ الكوبون

## API Endpoints

### الحصول على جميع الكوبونات
```bash
GET /api/v1/coupons
Headers: X-API-Key: your-api-key
```

**Response:**
```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "code": "SAVE20",
      "name": "خصم 20%",
      "price": 50.00,
      "is_paid": true,
      "formatted_price": "50.00 ريال",
      "type": "percentage",
      "value": "20.00",
      "is_valid": true
    }
  ]
}
```

### إنشاء كوبون مدفوع
```bash
POST /api/v1/coupons
Headers: 
  X-API-Key: your-api-key
  Content-Type: application/json

Body:
{
  "code": "PAID50",
  "name": "كوبون مدفوع",
  "type": "fixed",
  "value": 50,
  "price": 25,
  "is_paid": true,
  "status": "active"
}
```

### التحقق من صلاحية كوبون
```bash
POST /api/v1/coupons/validate
Headers: 
  X-API-Key: your-api-key
  Content-Type: application/json

Body:
{
  "code": "PAID50",
  "amount": 100
}
```

**Response للكوبون المدفوع:**
```json
{
  "status": "error",
  "message": "هذا الكوبون مدفوع ويحتاج إلى شراء بقيمة 25.00 ريال",
  "is_paid": true,
  "price": 25
}
```

### إحصائيات الكوبونات
```bash
GET /api/v1/coupons/stats
Headers: X-API-Key: your-api-key
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "total_coupons": 10,
    "active_coupons": 8,
    "paid_coupons": 3,
    "free_coupons": 7,
    "total_revenue": 150.00,
    "formatted_revenue": "150.00 ريال"
  }
}
```

## الواجهة الأمامية

### الإحصائيات الجديدة
- إجمالي الكوبونات
- إجمالي الإيرادات
- الكوبونات المدفوعة
- الكوبونات المجانية
- الكوبونات التي تنتهي قريباً

### الجدول المحسن
- عمود جديد للسعر
- عرض "مجاني" للكوبونات المجانية
- عرض السعر للكوبونات المدفوعة

### الفلاتر الجديدة
- فلتر حسب الحالة (نشط، غير نشط، منتهي)
- فلتر حسب النوع (مدفوع، مجاني)

## الدوال المساعدة

### في نموذج Coupon
```php
// التحقق من أن الكوبون مدفوع
$coupon->isPaid();

// الحصول على السعر مع التنسيق
$coupon->getFormattedPrice();

// حساب إجمالي الإيرادات
Coupon::getTotalRevenue();

// الحصول على الإيرادات مع التنسيق
Coupon::getFormattedTotalRevenue();
```

## أمثلة عملية

### مثال 1: كوبون خصم 50 ريال مقابل 25 ريال
```json
{
  "code": "HALF50",
  "name": "خصم نصف السعر",
  "type": "fixed",
  "value": 50,
  "price": 25,
  "is_paid": true
}
```

### مثال 2: كوبون خصم 30% مقابل 15 ريال
```json
{
  "code": "PERCENT30",
  "name": "خصم 30%",
  "type": "percentage",
  "value": 30,
  "price": 15,
  "is_paid": true
}
```

### مثال 3: كوبون مجاني
```json
{
  "code": "FREE10",
  "name": "خصم 10 ريال مجاني",
  "type": "fixed",
  "value": 10,
  "is_paid": false
}
```

## الأمان والتحقق

### التحقق من الكوبونات المدفوعة
- يتم التحقق من أن الكوبون مدفوع قبل السماح باستخدامه
- يتم إرجاع رسالة واضحة مع السعر المطلوب
- لا يمكن استخدام الكوبونات المدفوعة بدون دفع

### حماية البيانات
- كل مستخدم يرى فقط كوبوناته الخاصة
- لا يمكن الوصول لكوبونات المستخدمين الآخرين
- التحقق من الملكية قبل التعديل أو الحذف

## التطوير المستقبلي

### الميزات المقترحة
1. **نظام الدفع**: ربط مع بوابات الدفع
2. **التقارير المالية**: تقارير مفصلة عن الإيرادات
3. **الخصومات**: خصومات على الكوبونات المدفوعة
4. **الباقات**: باقات كوبونات بأسعار مختلفة
5. **الاشتراكات**: اشتراكات شهرية للكوبونات

### التحسينات المقترحة
1. **إشعارات**: إشعارات عند شراء كوبونات
2. **التتبع**: تتبع استخدام الكوبونات المدفوعة
3. **التحليلات**: تحليلات مفصلة عن الأداء
4. **التخصيص**: تخصيص أسعار حسب الفئات

## الدعم والمساعدة

إذا واجهت أي مشكلة أو تحتاج مساعدة، يمكنك:
1. مراجعة هذا الدليل
2. فحص رسائل الخطأ
3. التأكد من صحة البيانات المدخلة
4. التواصل مع فريق الدعم 
